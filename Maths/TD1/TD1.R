 
MM=apply(CM,2,function(X) X/sum(X))

# Après avoir chargé cette matrice dans R, transformez-la en une matrice MM (mutation matrix)
# qui contient des fréquences (aidez-vous des fonctions apply et sum). Ces fréquences sont 
# interprétées comme des probabilités de passer d'un acide aminé en un autre.

round(MM[1:10,1:10],2)
     A    R    N    D    C    Q    E    G    H    I
A 0.54 0.03 0.03 0.03 0.08 0.04 0.05 0.05 0.02 0.02
R 0.02 0.57 0.03 0.01 0.02 0.06 0.03 0.01 0.04 0.01
N 0.01 0.02 0.48 0.06 0.01 0.03 0.03 0.03 0.05 0.01
D 0.02 0.01 0.09 0.57 0.01 0.04 0.11 0.02 0.03 0.00
C 0.01 0.00 0.00 0.00 0.57 0.00 0.00 0.00 0.00 0.00
Q 0.02 0.04 0.03 0.02 0.01 0.42 0.05 0.01 0.04 0.01
E 0.04 0.04 0.05 0.13 0.01 0.11 0.52 0.02 0.03 0.01
G 0.05 0.02 0.05 0.03 0.02 0.02 0.02 0.77 0.02 0.00
H 0.00 0.01 0.02 0.01 0.01 0.02 0.01 0.00 0.54 0.00
I 0.02 0.01 0.01 0.00 0.03 0.01 0.01 0.00 0.01 0.50

CM2 = CM*diag(20)
CM2
     A    R    N    D   C    Q    E    G    H    I    L    K   M    F    P    S    T   W    Y    V
A 4372    0    0    0   0    0    0    0    0    0    0    0   0    0    0    0    0   0    0    0
R    0 2748    0    0   0    0    0    0    0    0    0    0   0    0    0    0    0   0    0    0
N    0    0 1727    0   0    0    0    0    0    0    0    0   0    0    0    0    0   0    0    0
D    0    0    0 3092   0    0    0    0    0    0    0    0   0    0    0    0    0   0    0    0
C    0    0    0    0 680    0    0    0    0    0    0    0   0    0    0    0    0   0    0    0
Q    0    0    0    0   0 1367    0    0    0    0    0    0   0    0    0    0    0   0    0    0
E    0    0    0    0   0    0 3378    0    0    0    0    0   0    0    0    0    0   0    0    0
G    0    0    0    0   0    0    0 5788    0    0    0    0   0    0    0    0    0   0    0    0
H    0    0    0    0   0    0    0    0 1059    0    0    0   0    0    0    0    0   0    0    0
I    0    0    0    0   0    0    0    0    0 3217    0    0   0    0    0    0    0   0    0    0
L    0    0    0    0   0    0    0    0    0    0 5061    0   0    0    0    0    0   0    0    0
K    0    0    0    0   0    0    0    0    0    0    0 3054   0    0    0    0    0   0    0    0
M    0    0    0    0   0    0    0    0    0    0    0    0 923    0    0    0    0   0    0    0
F    0    0    0    0   0    0    0    0    0    0    0    0   0 2191    0    0    0   0    0    0
P    0    0    0    0   0    0    0    0    0    0    0    0   0    0 2757    0    0   0    0    0
S    0    0    0    0   0    0    0    0    0    0    0    0   0    0    0 2326    0   0    0    0
T    0    0    0    0   0    0    0    0    0    0    0    0   0    0    0    0 2808   0    0    0
W    0    0    0    0   0    0    0    0    0    0    0    0   0    0    0    0    0 582    0    0
Y    0    0    0    0   0    0    0    0    0    0    0    0   0    0    0    0    0   0 1612    0
V    0    0    0    0   0    0    0    0    0    0    0    0   0    0    0    0    0   0    0 3784

CM=CM+CM2

# On multiplie la diag de CM par 2
CM
     A    R    N    D    C    Q    E     G    H    I     L    K    M    F    P    S    T    W    Y    V
A 8744  121  113  162   96  140  324   387   40  136   212  219   72   50  213  596  300    6   39  428
R  121 5496  100   70   20  188  170    88   69   48    85  679   38   26   46  129  110   10   30   59
N  113  100 3454  322   16   92  166   190   89   37    42  209   17   18   38  207  160    4   40   45
D  162   70  322 6184    8  127  732   154   68   18    36  176   11   14   67  204  120    4   24   28
C   96   20   16    8 1360    6    6    20    6   30    30   12   10   22    6   61   54    7   16   83
Q  140  188   92  127    6 2734  346    58   70   35   100  310   52   18   48  128  103    6   30   66
E  324  170  166  732    6  346 6756   138   63   40    68  411   29   13   93  212  192    6   28  104
G  387   88  190  154   20   58  138 11576   30   19    36  136   14   17   46  230   78    8   12   40
H   40   69   89   68    6   70   63    30 2118   14    39   92   16   54   34   48   40   13   96   27
I  136   48   37   18   30   35   40    19   14 6434   858   72  198  144   24   55  156   12   37 1300
L  212   85   42   36   30  100   68    36   39  858 10122  124  410  331   62  104  133   20   92  593
K  219  679  209  176   12  310  411   136   92   72   124 6108   48   23   84  216  172    4   32   84
M   72   38   17   11   10   52   29    14   16  198   410   48 1846   82   12   38   64    5   24  134
F   50   26   18   14   22   18   13    17   54  144   331   23   82 4382   14   38   39   59  367  101
P  213   46   38   67    6   48   93    46   34   24    62   84   12   14 5514  147   66    2   10   54
S  596  129  207  204   61  128  212   230   48   55   104  216   38   38  147 4652  490   13   28  100
T  300  110  160  120   54  103  192    78   40  156   133  172   64   39   66  490 5616    4   31  299
W    6   10    4    4    7    6    6     8   13   12    20    4    5   59    2   13    4 1164   48   14
Y   39   30   40   24   16   30   28    12   96   37    92   32   24  367   10   28   31   48 3224   42
V  428   59   45   28   83   66  104    40   27 1300   593   84  134  101   54  100  299   14   42 7568


# Nous avons donc besoin de calculer la fréquences de chaque acide aminé dans une séquence (ici, fréquences d'apparition dans 
# nos alignements de départ). Utilisez donc la matrice CM de départ qui contient le nombre de substitutions observées pour 
# calculer le vecteur Freq contenant la fréquence de chacun de a.a. 


totaa=sum(CM)
totaa
[1] 147232

Freq=apply(CM, 2, function(X)sum(X)/tota

# a)

Freq
         A          R          N          D          C          Q          E          G          H          I          L 
0.08420724 0.05149696 0.03639834 0.05792898 0.01269425 0.03163035 0.06722044 0.09017741 0.02055260 0.06565828 0.09167165 
         K          M          F          P          S          T          W          Y          V 
0.06256113 0.02119105 0.03947511 0.04469137 0.05227125 0.05587780 0.00956993 0.02886601 0.07585987 

round(Freq,2)
   A    R    N    D    C    Q    E    G    H    I    L    K    M    F    P    S    T    W    Y    V 
0.08 0.05 0.04 0.06 0.01 0.03 0.07 0.09 0.02 0.07 0.09 0.06 0.02 0.04 0.04 0.05 0.06 0.01 0.03 0.08 


# Il n'y a plus qu'à appliquer la formule S_{i,j} = 10 \times log_{10}\frac{M_{i,j}}{F_i}.

MS=10*log10(MM/Freq)
round(MS[1:10,1:10],1)
     A    R    N     D     C    Q     E     G    H     I
A  8.1 -5.3 -4.3  -4.5  -0.2 -3.0  -2.3  -2.1 -6.2  -6.0
R -5.3 10.4 -2.7  -6.0  -4.9  0.5  -3.0  -6.4 -1.7  -8.4
N -4.1 -2.5 11.2   2.1  -4.3 -1.1  -1.6  -1.6  0.9  -8.0
D -4.6 -6.0  1.8   9.9  -9.3 -1.8   2.9  -4.5 -2.2 -13.2
C -0.3 -4.9 -4.6  -9.4  16.5 -8.4 -11.4  -6.8 -6.2  -4.4
Q -2.6  0.9 -1.0  -1.3  -8.0 11.2   2.2  -6.1  0.5  -7.7
E -2.2 -2.8 -1.7   3.0 -11.2  1.9   8.9  -5.6 -3.2 -10.4
G -2.7 -6.9 -2.4  -5.0  -7.3 -7.1  -6.3   9.3 -7.7 -14.9
H -6.2 -1.6  0.8  -2.2  -6.1  0.2  -3.3  -7.1 14.2  -9.8
I -5.9 -8.2 -8.1 -13.0  -4.2 -7.9 -10.3 -14.1 -9.6   8.8

# Pour apprécier la distance évolutive entre les séquences que nous avions au départ,
# nous allons calculer le pourcentage moyen de mutation d'un acide aminé
# Fréquence de non mutation d'un a.a = diag(MM)
# Fréquence de mutation d'un a.a = 1-diag(MM)

PAM = Freq*100*(1-diag(MM))
>PAM
        A         R         N         D         C         Q         E         G         H         I         L         K 
3.8337060 2.2222311 1.9091088 2.4985004 0.5434293 1.8487893 3.2388312 2.0482277 0.9487422 3.2910577 3.6675179 3.1529508 
        M         F         P         S         T         W         Y         V 
1.2288299 1.5589454 1.2461680 2.9630106 2.6923220 0.2835106 1.1226885 3.6990031 

sum(PAM)
[1] 43.99757




EXO2

On sait que S = 10*log10(M/Freq)
-->MM=10^(Si,j - Si,k)/10) 

i=PAM250[,1]
> i
 [1]  2.7 -0.9 -0.4 -0.4  1.0 -0.2  0.0  0.4 -1.3 -1.1 -1.3 -0.5 -1.0 -2.5  0.6  1.2  0.5 -3.4 -2.6 -0.2

> M=apply(PAM250, 2, function(X) 10^((X-i)/10))
> round(M[1:10,1:10],2)
  A    R    N    D    C    Q    E    G    H    I
A 1 0.44 0.49 0.49 0.68 0.51 0.54 0.59 0.40 0.42
R 1 3.89 1.35 1.12 0.89 1.78 1.38 0.87 1.45 0.65
N 1 1.20 2.63 1.82 0.87 1.29 1.38 1.26 1.48 0.54
D 1 1.00 1.82 3.31 0.63 1.38 2.14 1.00 1.20 0.39
C 1 0.58 0.63 0.46 7.59 0.54 0.49 0.52 0.56 0.81
Q 1 1.51 1.23 1.32 0.71 2.09 1.55 0.74 1.29 0.63
E 1 1.12 1.26 1.95 0.62 1.48 2.19 0.79 1.02 0.46
G 1 0.65 1.05 0.83 0.60 0.65 0.72 4.57 0.59 0.26
H 1 1.58 1.82 1.48 0.95 1.66 1.38 0.87 6.92 0.72
I 1 0.68 0.63 0.46 1.32 0.78 0.59 0.37 0.69 3.31

On transpose M.
> A=t(M)
> A
          A         R         N         D         C         Q         E         G         H         I         L         K
A 1.0000000 1.0000000 1.0000000 1.0000000 1.0000000 1.0000000 1.0000000 1.0000000 1.0000000 1.0000000 1.0000000 1.0000000
R 0.4365158 3.8904514 1.2022644 1.0000000 0.5754399 1.5135612 1.1220185 0.6456542 1.5848932 0.6760830 0.7943282 2.2387211
N 0.4897788 1.3489629 2.6302680 1.8197009 0.6309573 1.2302688 1.2589254 1.0471285 1.8197009 0.6309573 0.6760830 1.3803843
D 0.4897788 1.1220185 1.8197009 3.3113112 0.4570882 1.3182567 1.9498446 0.8317638 1.4791084 0.4570882 0.5248075 1.2882496
C 0.6760830 0.8912509 0.8709636 0.6309573 7.5857758 0.7079458 0.6165950 0.6025596 0.9549926 1.3182567 1.1481536 0.7413102
Q 0.5128614 1.7782794 1.2882496 1.3803843 0.5370318 2.0892961 1.4791084 0.6456542 1.6595869 0.7762471 0.9120108 1.6595869
E 0.5370318 1.3803843 1.3803843 2.1379621 0.4897788 1.5488166 2.1877616 0.7244360 1.3803843 0.5888437 0.6456542 1.4791084
G 0.5888437 0.8709636 1.2589254 1.0000000 0.5248075 0.7413102 0.7943282 4.5708819 0.8709636 0.3715352 0.4168694 0.8709636
H 0.3981072 1.4454398 1.4791084 1.2022644 0.5623413 1.2882496 1.0232930 0.5888437 6.9183097 0.6918310 0.8912509 1.2882496
I 0.4168694 0.6456542 0.5370318 0.3890451 0.8128305 0.6309573 0.4570882 0.2630268 0.7244360 3.3113112 2.5703958 0.6025596
L 0.3981072 0.7244360 0.5495409 0.4265795 0.6760830 0.7079458 0.4786301 0.2818383 0.8912509 2.4547089 3.3884416 0.6606934
K 0.4786301 2.4547089 1.3489629 1.2589254 0.5248075 1.5488166 1.3182567 0.7079458 1.5488166 0.6918310 0.7943282 2.3442288
M 0.4265795 0.8709636 0.6456542 0.5128614 0.7079458 0.8709636 0.5754399 0.3467369 1.0000000 2.1877616 2.6915348 0.7943282
F 0.3019952 0.6309573 0.5623413 0.3981072 0.7585776 0.5888437 0.3890451 0.2630268 1.7378008 1.5488166 2.1379621 0.5248075
P 0.6165950 0.8912509 0.8511380 0.9120108 0.4786301 0.8912509 0.8709636 0.5495409 1.1748976 0.5888437 0.7244360 0.9332543
S 0.7079458 1.2022644 1.3182567 1.2302688 0.9332543 1.1220185 1.0964782 0.9549926 1.2022644 0.7762471 0.8317638 1.1748976
T 0.6025596 1.1220185 1.2022644 1.0232930 0.9549926 1.0471285 0.9772372 0.6165950 1.1481536 1.1481536 1.0471285 1.0964782
W 0.2454709 0.7079458 0.5370318 0.4073803 0.9332543 0.5754399 0.4073803 0.3388442 1.8620871 0.9332543 1.1481536 0.5011872
Y 0.2951209 0.7762471 0.7943282 0.5623413 0.7585776 0.7244360 0.5128614 0.3019952 2.6915348 1.0232930 1.4125375 0.6606934
V 0.5128614 0.6918310 0.6025596 0.4786301 1.0000000 0.6918310 0.5623413 0.3467369 0.7762471 2.8183829 2.1379621 0.6606934
          M         F         P         S         T          W          Y         V
A 1.0000000 1.0000000 1.0000000 1.0000000 1.0000000  1.0000000  1.0000000 1.0000000
R 0.8912509 0.9120108 0.6309573 0.7413102 0.8128305  1.2589254  1.1481536 0.5888437
N 0.7413102 0.9120108 0.6760830 0.9120108 0.9772372  1.0715193  1.3182567 0.5754399
D 0.5888437 0.6456542 0.7244360 0.8511380 0.8317638  0.8128305  0.9332543 0.4570882
C 1.1220185 1.6982437 0.5248075 0.8912509 1.0715193  2.5703958  1.7378008 1.3182567
Q 1.0471285 1.0000000 0.7413102 0.8128305 0.8912509  1.2022644  1.2589254 0.6918310
E 0.7244360 0.6918310 0.7585776 0.8317638 0.8709636  0.8912509  0.9332543 0.5888437
G 0.4786301 0.5128614 0.5248075 0.7943282 0.6025596  0.8128305  0.6025596 0.3981072
H 0.9332543 2.2908677 0.7585776 0.6760830 0.7585776  3.0199517  3.6307805 0.6025596
I 2.1379621 2.1379621 0.3981072 0.4570882 0.7943282  1.5848932  1.4454398 2.2908677
L 2.5118864 2.8183829 0.4677351 0.4677351 0.6918310  1.8620871  1.9054607 1.6595869
K 0.8912509 0.8317638 0.7244360 0.7943282 0.8709636  0.9772372  1.0715193 0.6165950
M 3.4673685 2.5703958 0.4677351 0.5370318 0.7762471  1.8197009  1.8620871 1.5135612
F 1.8197009 9.1201084 0.3467369 0.4073803 0.5495409  6.6069345  7.2443596 1.0471285
P 0.6760830 0.7079458 6.3095734 0.8511380 0.7413102  0.6760830  0.7762471 0.6025596
S 0.8912509 0.9549926 0.9772372 1.2882496 1.2589254  1.2589254  1.0715193 0.7585776
T 1.0964782 1.0964782 0.7244360 1.0715193 1.9054607  1.0471285  1.1220185 1.0715193
W 1.0471285 5.3703180 0.2691535 0.4365158 0.4265795 66.0693448  6.3095734 0.6918310
Y 1.2882496 7.0794578 0.3715352 0.4466836 0.5495409  7.5857758 12.5892541 0.7413102
V 1.8197009 1.7782794 0.5011872 0.5495409 0.9120108  1.4454398  1.2882496 2.3442288

Puis on applique la formule : A^(-1)b=x

> solve(A)%*%b
         [,1]
A 0.154503863
R 0.042596631
N 0.038403741
D 0.049782367
C 0.015879060
Q 0.033017978
E 0.072698722
G 0.085780947
H 0.015098730
I 0.051743931
L 0.064899284
K 0.055493562
M 0.020671036
F 0.020979535
P 0.046980976
S 0.070093255
T 0.065180801
W 0.003990861
Y 0.015479002
V 0.076725718

On remarque que cela correspond à multiplier la 1ère colonne de A par x1, la 2ème colonne de A par x2, ...

Et comme A = MT, cela correspond à multiplier la 1ère ligne de MM par x1, la 2ème ligne de MM par x2, ...

Après avoir vérifié que A est inversible, déterminez la matrice MM.

> MM=apply(M,2,function(X)  X*x) 
> round(MM[1:10,1:10],2)
         A    R    N    D    C    Q    E    G    H    I
 [1,] 0.15 0.07 0.08 0.08 0.10 0.08 0.08 0.09 0.06 0.06
 [2,] 0.04 0.17 0.06 0.05 0.04 0.08 0.06 0.04 0.06 0.03
 [3,] 0.04 0.05 0.10 0.07 0.03 0.05 0.05 0.05 0.06 0.02
 [4,] 0.05 0.05 0.09 0.16 0.03 0.07 0.11 0.05 0.06 0.02
 [5,] 0.02 0.01 0.01 0.01 0.12 0.01 0.01 0.01 0.01 0.01
 [6,] 0.03 0.05 0.04 0.04 0.02 0.07 0.05 0.02 0.04 0.02
 [7,] 0.07 0.08 0.09 0.14 0.04 0.11 0.16 0.06 0.07 0.03
 [8,] 0.09 0.06 0.09 0.07 0.05 0.06 0.06 0.39 0.05 0.02
 [9,] 0.02 0.02 0.03 0.02 0.01 0.03 0.02 0.01 0.10 0.01
[10,] 0.05 0.03 0.03 0.02 0.07 0.04 0.03 0.02 0.04 0.17

> A=MM[,1]
> B=MM[1,]
> F=A/B
> F
        A         R         N         D         C         Q         E         G         H         I         L         K 
1.0000000 0.6315910 0.5074978 0.6578641 0.1520147 0.4166881 0.8761681 0.9428693 0.2454715 0.8033783 1.0551169 0.7504180 
        M         F         P         S         T         W         Y         V 
0.3136338 0.4496313 0.4931541 0.6408212 0.7001327 0.1052270 0.3394717 0.9682815

> Freq=F/sum(F)
> round(Freq,2)
   A    R    N    D    C    Q    E    G    H    I    L    K    M    F    P    S    T    W    Y    V 
0.08 0.05 0.04 0.05 0.01 0.03 0.07 0.08 0.02 0.07 0.09 0.06 0.03 0.04 0.04 0.05 0.06 0.01 0.03 0.08 